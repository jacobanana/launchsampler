# Documentation Guide

This document explains how the LaunchSampler documentation is structured and how to work with it.

## Structure

```
docs/
├── api/              # Auto-generated API documentation
├── getting-started/  # Installation and quick start guides
├── user-guide/       # User documentation
├── architecture/     # Architecture documentation
├── contributing/     # Contributing guidelines
└── index.md         # Documentation homepage

mkdocs.yml           # MkDocs configuration
scripts/
└── generate_api_docs.py  # API docs generator
```

## Building Documentation Locally

### Prerequisites

Install development dependencies:

```bash
uv sync --group dev
```

### Generate API Documentation

The API documentation is automatically generated from Python docstrings:

```bash
uv run python scripts/generate_api_docs.py
```

This will:
- Scan all Python modules in `src/launchsampler/`
- Generate markdown files with `:::` directives in `docs/api/`
- Create package overview pages
- Update navigation structure in `docs/api_nav.yml`

**When to regenerate:**
- After adding new modules or packages
- After restructuring the codebase
- When you want the latest docstrings in docs

### Serve Documentation

Start a local development server with live reload:

```bash
uv run mkdocs serve
```

Visit http://127.0.0.1:8000 to view the documentation.

Changes to markdown files are reflected immediately. If you modify Python docstrings, re-run the API docs generator.

### Build Static Site

Build the complete documentation site:

```bash
uv run mkdocs build
```

Output is generated in `site/` directory (ignored by git).

## Deployment

Documentation is automatically built and deployed to GitHub Pages via GitHub Actions:

- **On push to `main`**: Docs are built and deployed
- **On pull requests**: Docs are built (but not deployed) to check for errors

The workflow (`.github/workflows/docs.yml`) does:
1. Install dependencies with `uv`
2. Generate API documentation
3. Build docs with `mkdocs build --strict`
4. Deploy to GitHub Pages (on main branch only)

### Manual Deployment

To manually deploy to GitHub Pages:

```bash
uv run mkdocs gh-deploy
```

This builds and pushes to the `gh-pages` branch.

## Writing Documentation

### Markdown Files

Standard markdown files in `docs/` are written manually:
- User guides
- Tutorials
- Architecture docs
- Contributing guidelines

### API Documentation

API docs are **auto-generated** from Python docstrings. To document code:

1. **Write Google-style docstrings** in your Python modules:

```python
def my_function(param: str) -> int:
    """
    Short description.

    Longer description with details.

    Args:
        param: Description of parameter

    Returns:
        Description of return value

    Raises:
        ValueError: When something goes wrong
    """
```

2. **Add architecture diagrams** in module docstrings:

```python
"""
Module description.

Architecture Diagram
--------------------

::

    Component A
        ↓
    Component B
        ↓
    Component C
"""
```

3. **Regenerate API docs** to see changes:

```bash
uv run python scripts/generate_api_docs.py
```

### Adding New Documentation Pages

1. Create markdown file in appropriate `docs/` subdirectory
2. Add entry to `nav:` section in `mkdocs.yml`
3. Preview with `uv run mkdocs serve`

## Configuration

### mkdocs.yml

Main configuration file. Key sections:

- `site_name`, `site_description`: Site metadata
- `theme`: Material theme configuration
- `plugins`: Enabled plugins (search, mkdocstrings, etc.)
- `markdown_extensions`: Markdown features
- `nav`: Documentation navigation structure

### mkdocstrings Configuration

API documentation is configured in `mkdocs.yml`:

```yaml
plugins:
  - mkdocstrings:
      handlers:
        python:
          options:
            docstring_style: google
            show_source: true
            # ... other options
```

## Troubleshooting

### API docs not updating

Re-run the generator:
```bash
uv run python scripts/generate_api_docs.py
```

### Build warnings

Run strict build to catch all issues:
```bash
uv run mkdocs build --strict
```

### Type annotation warnings

Ensure all public APIs have proper type hints. See:
- `src/launchsampler/audio/device.py`
- `src/launchsampler/devices/registry.py`
- `src/launchsampler/utils/observer_manager.py`

For examples of proper type annotations.

## Best Practices

1. **Commit `docs/`, not `site/`**
   - Source files belong in git
   - Build output is regenerated by CI

2. **Regenerate API docs after code changes**
   - Keep documentation in sync with code
   - Run generator before committing

3. **Write descriptive docstrings**
   - They become your API documentation
   - Include examples when helpful

4. **Use diagrams in docstrings**
   - ASCII diagrams render well in docs
   - Great for explaining architecture

5. **Test docs build before committing**
   ```bash
   uv run mkdocs build --strict
   ```

## Resources

- [MkDocs Documentation](https://www.mkdocs.org/)
- [Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)
- [mkdocstrings](https://mkdocstrings.github.io/)
- [Google Style Python Docstrings](https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings)
